---
title: "Task 3 - Analyzing Sea Urchins"
author: "Trevor Maggart"
date: "10/26/2021"
output: html_document
---

## Overview 

This code analyzes data pertaining to red and purple sea urchins collected by divers with the Santa Barbara Coastal Long Term Ecological Research program. The analysis below looks at the distribution of urchins from 2008 - 2020 at five different sites. 

### Data Citation

Citation: Santa Barbara Coastal LTER and D. Reed. 2020. SBC LTER: Reef: Long-term experiment: Kelp removal: Urchin size frequency distribution ver 20. Environmental Data Initiative. https://doi.org/10.6073/pasta/5a1e9ef03aa47bd2225c0bb98a02a63b (Accessed 2021-10-26).

### Setup

```{r setup, message=F}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

### Install Packages

To wrangle the data we will use the packages `tidyverse`, `here`, `janitor`, `kableExtra`, and `lubridate`.

```{r packages}
# Attach packages
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
```

### Read in the data

Read in the urchins data & conver to 'lower_case_snake'

```{r}
# Read in the data
urchins <- read_csv(here("data","urchins.csv")) %>%
  clean_names() # Clean the data to lower_case_snake
```

### Data Visualization

Create a histogram of the size distribution of red and purple urchins 

```{r}
ggplot(data = urchins, 
       aes(x = size)) +
  geom_histogram(bins = 10, aes(fill = common_name, color = common_name)) +
  theme_grey() +
  facet_wrap(~common_name) + # Facet wrap by 'common_name' 
  scale_fill_manual(values = c("#b266b2", "#ff7f7f")) + # Allows me to manually choose colors 
  scale_color_manual(values = c("white","white")) +
  labs(title = "Size Distribution of Purple and Red Sea Urchins",
       x = "Size (cm)",
       y = "Count",
       key = "Common Name",
       fill = "Common Name",
       caption = "Fig 1. Distribution of purple and red sea urchins from the Santa Barbara Coastal Long Term Ecological Research") +
  theme(axis.text.x = element_text(size=8),
        axis.title.x = element_text(hjust = 0.5, vjust = 0.2),
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.4),
        legend.position = "none",
)
```

### Descriptive Statistics Table 

Create a finalized summary table that contains the following statistics for purple and red urchins (still ignoring site as a variable, but including species as a grouping variable): mean, median, standard deviation, and sample size. 

```{r}
urchins_summary <- urchins %>%
  group_by(common_name) %>%
  summarize(mean_size = mean(size, na.rm = TRUE),
            median_size = median(size, na.rm = TRUE),
            sd_size = sd(size, na.rm = TRUE),
            sample_size = n())
```

### Use KableExtra to finalize the table

```{r}
urchins_summary %>%
  kable(col.names = c("Common Name",
                      "Mean Size (cm)",
                      "Median Size (cm)",
                      "Standard Deviation (cm)",
                      "Sample Size"),
        caption = "<center>Table 1. Summary of Statistics of Purple and Red Urchins<center>",
        digits = 2) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "center")
```

Observing the data we can see that the size distribution of purple urchins is slightly positively-skewed compared to the red urchins. Moreover, the purple urchins have a similar mean and median, and a smaller standard deviation showing the data to have less spread than the red urchins. On average, the red urchins are approximately 2.3 cm larger than the purple urchins, which results in a 41% size difference. 

## Section 2

Explore purple urchin counts by site and year

```{r}
purple_urchins <- urchins %>%
  filter(common_name == 'Purple Urchin') %>% # Include only purple urchins
  mutate(mdy = mdy(date)) %>% # Create a new date column
  mutate(year = year(mdy)) %>% # Create a new year column
  mutate(site_full = case_when( # Use case_when to create a new site column
    site == "NAPL" ~ "Naples Reef",
    site == "AQUE" ~ "Arroyo Quemado Reef",
    site == "CARP" ~ "Carpinteria Reef",
    site == "MOHK" ~ "Mohawk Reef",
    site == "IVEE" ~ "Isla Vista Reef"
  ))
```

### Create a table to display the data

```{r}
purple_count <- purple_urchins %>%
  group_by(site_full, year) %>%
  summarize(count = n())
```
### Create a line graph to visualize the data

```{r}
ggplot(data = purple_count,
       aes(x = year, y = count)) +
  geom_line(aes(color = site_full)) +
  theme_grey() +
  labs(title = "Distribution of Purple Urchins from 2008-2020",
       x = "Year",
       y = "Total Number of Purple Urchins",
       key = "Site",
       fill = "Site",
       color = "Site Location",
       caption = "Fig 1.1 Distribution of purple urchins by site from 2008-2020 from \n the Santa Barbara Coastal Long Term Ecological Research") +
  theme(axis.text.x = element_text(size=8),
        axis.title.x = element_text(hjust = 0.5, vjust = 0.2),
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5))
```

### Create a histogram to visualize the data

```{r}
ggplot(data = purple_count, 
       aes(x = year, y = count)) +
  geom_col(aes(fill = site_full)) +
  theme_grey() +
  facet_wrap(~site_full) + # Facet wrap by 'site_full' 
  labs(title = "Distribution of Purple Urchins from 2008-2020",
       x = "Year",
       y = "Total Number of Purple Urchins",
       key = "Site",
       fill = "Site",
       caption = "Fig 1.2 Distribution of purple urchins by site from 2008-2020 from \n the Santa Barbara Coastal Long Term Ecological Research") +
  theme(axis.text.x = element_text(size=8),
        axis.title.x = element_text(hjust = 0.5, vjust = 0.2),
        plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5),
        legend.position = "none")
```

This data may not accurately portray the overall trends in purple sea urchin populations along the coast of Santa Barbara. The data was collected at long-term kelp removal sites, which may not be representative of the environmental conditions of the entire coast of Santa Barbara. It is apparent that there has been a decrease in purple sea urchin populations across these sites; however, whether or not we can extrapolate that trend to all environments containing purple sea urchins is uncertain. Moreover, the significant drop around 2020 could be due to lack of sampling caused by the COVID pandemic. 